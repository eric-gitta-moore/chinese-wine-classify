# 葡萄酒数据预处理流程

本项目对葡萄酒的阻抗频率数据进行了预处理，主要包括以下步骤：

## 1. 数据分组

使用 `group_wine_data.py` 脚本将原始数据按连续频率进行分组：
- 读取清洗后的数据文件 `cleaned_wine_data.csv`
- 根据频率的连续性为每个样本分配唯一的 `sample_id`
- 当频率不连续或非单调递增时，创建新的样本 ID
- 输出分组后的数据到 `按连续频率把样本分组到sample.csv`

## 2. 数据插值和补齐

使用 `interp.py` 脚本对数据进行插值和补齐处理：
- 读取分组后的数据
- 对每个葡萄酒样本（wine_id）进行处理：
  - 识别相对完整的样本（包含 120Hz 数据）
  - 对完整样本进行线性插值，生成 20-120Hz 的连续数据
  - 计算完整样本的平均阻抗值
  - 对不完整的样本，使用平均阻抗值进行补齐
- 输出处理后的数据到 `插值+平均补齐到120Hz.csv`

## 3. 数据转宽表

使用 `transport.py` 脚本将数据转换为宽表格式：
- 读取插值补齐后的数据
- 使用 pivot 函数将频率数据转换为宽表格式：
  - 行索引：wine_id, wine_name, 类别，类别编码，sample_id
  - 列：20-120Hz 的频率值
  - 值：对应的阻抗值
- 输出宽表数据到 `频率数据宽表.csv`

## 4. 葡萄酒分类器

项目包含三个不同的分类器实现：

### 4.1 基础分类器 (wine_classifier.py)
使用三层全连接神经网络构建的葡萄酒分类模型：
- 数据预处理：
  - 读取清洗后的数据
  - 按 wine_id 分组，将每个酒样的频率 - 阻抗数据组织成特征向量
  - 对数据进行标准化处理
  - 对类别标签进行编码
- 模型架构：
  - 三层全连接神经网络
  - 输入层：频率 - 阻抗特征
  - 两个隐藏层：每层 128 个神经元
  - 输出层：葡萄酒类别
- 训练过程：
  - 使用 Adam 优化器
  - 交叉熵损失函数
  - 训练 10000 个 epoch
  - 保存训练过程中的损失曲线
- 模型评估：
  - 在测试集上评估模型准确率
  - 保存训练好的模型权重
  - 输出类别编码映射关系

### 4.2 CNN 分类器 (wine_classifier_cnn.py)
使用卷积神经网络 (CNN) 构建的葡萄酒分类模型：
- 模型架构：
  - 三个卷积层，每层后接批归一化和最大池化
  - 卷积核大小：5，步长：1，填充：2
  - 通道数依次为：32 -> 64 -> 128
  - 全连接层：256 个神经元，输出层为类别数
  - 使用 Dropout(0.5) 防止过拟合
- 训练过程：
  - 使用 Adam 优化器
  - 交叉熵损失函数
  - 训练 5000 个 epoch
  - 保存训练过程中的损失曲线到`loss_curve_cnn.png`
- 模型评估：
  - 在测试集上评估模型准确率
  - 输出类别编码映射关系

### 4.3 特征选择分类器 (wine_classifier_feature_choose.py)
通过特征选择优化的葡萄酒分类模型：
- 数据预处理：
  - 选择关键频率点（每隔 5 个点取一个）
  - 对特征进行标准化处理
  - 对类别标签进行编码
- 模型架构：
  - 三层全连接神经网络
  - 输入层：选择后的频率特征
  - 两个隐藏层：每层 64 个神经元
  - 输出层：葡萄酒类别
- 训练过程：
  - 使用 Adam 优化器
  - 交叉熵损失函数
  - 训练 5000 个 epoch
  - 保存训练过程中的损失曲线到`loss_curve_feature_choose.png`
- 模型评估：
  - 在测试集上评估模型准确率
  - 保存训练好的模型权重到`wine_classifier_feature_choose.pth`
  - 输出类别编码映射关系

## 5. 数据文件说明

- `cleaned_wine_data.csv`: 清洗后的原始数据
- `按连续频率把样本分组到sample.csv`: 按连续频率分组后的数据
- `插值+平均补齐到120Hz.csv`: 经过插值和补齐处理后的数据
- `频率数据宽表.csv`: 转换后的宽表格式数据
- `wine_classifier.pth`: 训练好的模型权重文件
- `loss_curve.png`: 训练过程中的损失曲线图
- `wine_classifier.py`: 葡萄酒分类器的主要实现文件，包含数据预处理、模型定义、训练和评估等功能
- `loss_curve_cnn.png`: CNN 分类器训练过程中的损失曲线图
- `wine_classifier_feature_choose.pth`: 特征选择分类器训练好的模型权重文件
- `loss_curve_feature_choose.png`: 特征选择分类器训练过程中的损失曲线图

## 6. 环境依赖

项目依赖的 Python 包在 `requirements.txt` 中列出，主要包括：
- pandas
- numpy
- scipy
- torch
- sklearn
- matplotlib

### 使用 uv 安装依赖

[uv](https://github.com/astral-sh/uv) 是一个快速的 Python 包安装器和解析器，比 pip 更快。以下是使用 uv 安装项目依赖的步骤：

1. 安装 uv（如果尚未安装）：
   ```bash
   pip install uv
   ```

2. 使用 uv 安装项目依赖：
   ```bash
   uv sync
   ```

3. 可选：创建虚拟环境并安装依赖：
   ```bash
   # 创建虚拟环境
   uv venv
   
   # 激活虚拟环境
   # Windows:
   .venv\Scripts\activate
   # Linux/MacOS:
   source .venv/bin/activate
   
   # 安装依赖
   uv sync
   ```

uv 的优势：
- 比 pip 快 10-100 倍
- 支持并行安装
- 更好的依赖解析
- 支持锁定文件
- 与 pip 完全兼容
